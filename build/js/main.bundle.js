(()=>{"use strict";const e=document.querySelector("#card").content.querySelector(".popup"),t={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Доврец"},r=document.querySelector(".map__filters"),o=document.querySelector(".ad-form"),n=r.querySelectorAll("select"),a=document.querySelectorAll("fieldset");r.classList.add("ad-form--disabled"),o.classList.add("ad-form--disabled");const l=e=>{e.disabled=!0},c=e=>{e.disabled=!1};n.forEach(l),a.forEach(l);const s=window.L,i=35.6895,d=139.69171,u=document.querySelector("#address"),p=s.layerGroup(),y=s.map("map-canvas").on("load",(()=>{r.classList.remove("ad-form--disabled"),o.classList.remove("ad-form--disabled"),n.forEach(c),a.forEach(c)})).setView({lat:i,lng:d},9);s.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(y);const m=s.icon({iconUrl:"/img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),f=s.icon({iconUrl:"/img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),h=s.marker({lat:i,lng:d},{draggable:!0,icon:m}),g=h.getLatLng(),v=r=>{p.clearLayers(),r.slice(0,10).forEach((r=>{const o=s.marker({lat:r.location.lat,lng:r.location.lng},{icon:f});o.bindPopup((r=>{const o=e.cloneNode(!0),n=o.querySelector(".popup__avatar"),a=o.querySelector(".popup__title"),l=o.querySelector(".popup__text--address"),c=o.querySelector(".popup__text--price"),s=o.querySelector(".popup__type"),i=o.querySelector(".popup__text--capacity"),d=o.querySelector(".popup__text--time"),u=o.querySelector(".popup__description"),p=o.querySelector(".popup__features"),y=o.querySelector(".popup__photos");var m,f;return n.src=r.author.avatar,a.textContent=r.offer.title,l.textContent=r.offer.address,c.textContent=r.offer.price+" ₽/ночь",s.textContent=t[r.offer.type],i.textContent=`${f=r.offer.rooms,1===f&&(f+=" комната"),f>1&&f<5&&(f+=" комнаты"),f>=5&&f<20&&(f+=" комнат"),f} для ${m=r.offer.guests,m+(1===m?" гостя":" гостей")}`,d.textContent=`Заезд после ${r.offer.checkin} выезд до ${r.offer.checkout}`,u.textContent=r.offer.description,((e,t)=>{e.innerHTML="";for(let r=0;r<t.length;r++){const o=document.createElement("li");o.classList.add("popup__feature",`popup__feature--${t[r]}`),e.appendChild(o)}})(p,r.offer.features),((e,t)=>{e.innerHTML="";for(let r=0;r<t.length;r++){const o=document.createElement("img");o.className="popup__photo",o.width="45",o.height="40",o.alt="Фотография жилья",o.src=t[r],e.appendChild(o)}})(y,r.offer.photos),o})(r)),p.addLayer(o)}))};p.addTo(y),h.addTo(y),u.value=`${g.lat}, ${g.lng}`,h.on("move",(e=>{const t=e.target.getLatLng();u.value=`${t.lat.toFixed(5)}, ${t.lng.toFixed(5)}`}));const S=()=>{y.setView({lat:i,lng:d},9),h.setLatLng({lat:i,lng:d}),u.value="35.6895, 139.69171"},q=({url:e,method:t="GET",headers:r=new Headers,body:o=null})=>fetch(`https://22.javascript.pages.academy/keksobooking${e}`,{method:t,headers:r,body:o}).then((e=>{if(e.ok)return e.json();throw new Error("`${response.status}: ${response.statusText}`")})),L=(e,t)=>q({url:"/data"}).then(e).catch(t),E=e=>"Escape"===e.key,w=document.querySelector("main"),C=document.querySelector("#success").content.querySelector(".success"),b=document.querySelector("#error").content.querySelector(".error"),x=(e,t)=>{e.remove(),document.removeEventListener("keydown",t)},k=()=>{document.addEventListener("keydown",V),b.querySelector(".error__message").textContent="Ошибка размещения объявления",b.addEventListener("click",$),w.appendChild(b)},V=e=>{E(e)&&(e.preventDefault(),x(b,V))},$=()=>{x(b,V),b.removeEventListener("click",$)},T=e=>{E(e)&&(e.preventDefault(),x(C,T))},A=()=>{x(C,T),C.removeEventListener("click",A)},D=document.querySelector(".map__filters"),M=D.querySelector("#housing-type"),j=D.querySelector("#housing-price"),F=D.querySelector("#housing-rooms"),U=D.querySelector("#housing-guests"),z=(e,t,r)=>"any"===r.value||e.offer[t].toString()===(r.value||"any"),H=e=>z(e,"type",M)&&z(e,"rooms",F)&&z(e,"guests",U)&&(e=>{switch(j.value){case"middle":return e.offer.price<=5e4&&e.offer.price>=1e4;case"low":return e.offer.price<1e4;case"high":return e.offer.price>5e4}return!0})(e)&&(e=>{const t=D.querySelectorAll('input[type="checkbox"]:checked'),r=e.offer.features;if(!t.length)return!0;for(let e of t)if(!r.includes(e.value))return!1;return!0})(e),N=e=>{v(e),D.addEventListener("change",_.debounce((()=>{p.clearLayers(),v(e.filter(H))}),500))},O=document.querySelector(".ad-form"),G=O.querySelector("#type"),P=O.querySelector("#price"),R=O.querySelector("#timein"),W=O.querySelector("#timeout"),B=O.querySelector("#room_number"),I=O.querySelector("#capacity"),J=Array.from(I.options),K=document.querySelector("#title"),Q=document.querySelector("#price"),X={1:["1"],2:["1","2"],3:["1","2","3"],100:["0"]},Y={bungalow:0,flat:1e3,house:5e3,palace:1e4},Z=()=>{J.forEach((e=>{e.disabled=!X[B.value].includes(e.value),e.selected=!e.disabled}))};Z(),B.addEventListener("change",(()=>{Z()}));const ee=()=>{const e=K.value.length;K.validity.tooShort?K.setCustomValidity("Ещё "+(30-e)+" симв., бро!"):K.validity.tooLong?K.setCustomValidity("Удали лишние "+(e-100)+" симв., бро!"):K.validity.valueMissing?K.setCustomValidity("Обязательное поле, бро!"):K.setCustomValidity("")};K.addEventListener("invalid",(()=>{ee()})),K.addEventListener("input",(()=>{ee(),K.reportValidity()}));const te=()=>{Q.validity.valueMissing?Q.setCustomValidity("Обязательное поле, бро!"):Q.validity.rangeUnderflow?Q.setCustomValidity("Нужно больше золота! ("+Q.min+")"):Q.validity.rangeOverflow?Q.setCustomValidity("Ну это тумач!"):Q.setCustomValidity("")};Q.addEventListener("invalid",(()=>{te()})),Q.addEventListener("input",(()=>{te(),Q.reportValidity()})),G.addEventListener("change",(()=>{let e=G.value;P.placeholder=Y[e],P.min=Y[e]})),R.addEventListener("change",(()=>{let e=R.value;W.value=e})),W.addEventListener("change",(()=>{let e=W.value;R.value=e}));const re=()=>{document.addEventListener("keydown",T),C.addEventListener("click",A),w.appendChild(C),O.reset(),D.reset(),L(N),S()};O.addEventListener("submit",(e=>{var t,r,o;e.preventDefault(),t=re,r=k,o=new FormData(e.target),q({url:"",method:"POST",body:o}).then(t).catch(r)})),O.querySelector(".ad-form__reset").addEventListener("click",(e=>{e.preventDefault(),O.reset(),S()})),L(N,(()=>{k(),b.querySelector(".error__message").textContent="Объявления не загрузились"}));const oe=["gif","jpg","jpeg","png"],ne=O.querySelector("#avatar"),ae=O.querySelector(".ad-form-header__preview").querySelector("img"),le=O.querySelector("#images"),ce=O.querySelector(".ad-form__photo");ce.style.width="auto",ce.style.minWidth="70px",ce.style.marginTop="2px";const se=(e,t,r)=>{e.addEventListener("change",(e=>{const o=e.target.files[0],n=o.type.toLowerCase();if(oe.some((e=>n.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(e=>{r(e,t)})),e.readAsDataURL(o)}}))};se(ne,ae,((e,t)=>{t.src=e.target.result})),se(le,ce,((e,t)=>{const r=document.createElement("img");r.className="popup__photo",r.width="70",r.alt="Фотография жилья",r.src=e.target.result,t.appendChild(r)}))})();
//# sourceMappingURL=main.bundle.js.map